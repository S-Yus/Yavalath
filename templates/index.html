<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Yavalathï¼ˆ4ã§å‹ã¡ï¼3ã§è² ã‘ï¼‰</title>
<style>
:root {
  --grid:#2c3149;
  --p1:#ffd84d;
  --p2:#f5f7fb;
  --hint:#35d1ff6b;
  --win:#ff4d7a;
  --text:#eef3ff;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: radial-gradient(circle at center, #0a0e1a 0%, #010208 100%);
  color: var(--text);
  font-family: ui-rounded, "SF Pro Rounded", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆä¸Šéƒ¨å›ºå®šï¼‰ */
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 10;
  padding: 6px 12px;
  text-align: center;
  font-weight: 600;
  font-size: 14px;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚­ã‚¹ãƒˆ */
#status {
  font-weight: 700;
  margin-top: 2px;
}

/* ç›¤é¢ã‚¨ãƒªã‚¢ï¼ˆä½™ç™½ã‚¼ãƒ­ã§ä¸­å¤®é…ç½®ï¼‰ */
.stage {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: radial-gradient(circle at center, #111422, #05070c 90%);
}

/* ç›¤é¢ã‚µã‚¤ã‚ºï¼šç”»é¢ã®çŸ­è¾ºã„ã£ã±ã„ */
#board {
  width: 100vmin;
  height: 100vmin;
  max-width: 100vw;
  max-height: 100vh;
}

/* ç¸¦é•·ã‚¹ãƒãƒ›ãƒ»æ¨ªé•·PCä¸¡å¯¾å¿œ */
@media (orientation: portrait) {
  #board {
    width: 100vw;
    height: 100vw;
  }
}
@media (orientation: landscape) {
  #board {
    width: 100vh;
    height: 100vh;
  }
}

/* ã‚»ãƒ«ã¨çŸ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.hex {
  fill: #0d1124;
  stroke: var(--grid);
  stroke-width: 1.3;
  cursor: pointer;
}
.hex:hover { filter: brightness(1.2); }

.stone { pointer-events: none; }
.stone.p1 { fill: var(--p1); }
.stone.p2 { fill: var(--p2); }

.win-line {
  stroke: var(--win);
  stroke-width: 7;
  stroke-linecap: round;
}
</style>
</head>
<body>
<div class="header">
  <div>Yavalathï¼ˆ4ã§å‹ã¡ï¼3ã§è² ã‘ï¼‰</div>
  <div id="status"></div>
</div>

<div class="stage">
  <svg id="board" viewBox="-400 -400 800 800">
    <g id="layer-grid"></g>
    <g id="layer-stones"></g>
    <g id="layer-effects"></g>
  </svg>
</div>

<script>
const RADIUS = 5, HEX_SIZE = 28;
const DIRS = [[+1,0],[+1,-1],[0,-1],[-1,0],[-1,+1],[0,+1]];
const key = (q,r) => `${q},${r}`;
const toXY = (q,r) => ({x:HEX_SIZE*(Math.sqrt(3)*q+Math.sqrt(3)/2*r),y:HEX_SIZE*(3/2*r)});
const poly = (x,y,s) => {
  const pts=[];for(let i=0;i<6;i++){const a=(60*i-30)*Math.PI/180;pts.push([x+s*Math.cos(a),y+s*Math.sin(a)]);}
  return pts.map(p=>p.join(",")).join(" ");
};

const S={cells:new Map(),turn:1,gameOver:false};
const gGrid=document.getElementById("layer-grid");
const gStones=document.getElementById("layer-stones");
const gFx=document.getElementById("layer-effects");
const status=document.getElementById("status");

function msg(t){status.textContent=t||`æ‰‹ç•ª: ${S.turn===1?"é»„ğŸŸ¡":"ç™½âšªï¸"}`;}

function init(){
  gGrid.innerHTML=gStones.innerHTML=gFx.innerHTML="";
  S.cells.clear();S.turn=1;S.gameOver=false;
  for(let q=-RADIUS+1;q<=RADIUS-1;q++){
    const r1=Math.max(-RADIUS+1,-q-RADIUS+1);
    const r2=Math.min(RADIUS-1,-q+RADIUS-1);
    for(let r=r1;r<=r2;r++){
      const {x,y}=toXY(q,r);const k=key(q,r);
      const h=document.createElementNS("http://www.w3.org/2000/svg","polygon");
      h.setAttribute("points",poly(x,y,HEX_SIZE*0.98));
      h.classList.add("hex");h.dataset.k=k;h.onclick=onClick;gGrid.appendChild(h);
      const s=document.createElementNS("http://www.w3.org/2000/svg","circle");
      s.setAttribute("cx",x);s.setAttribute("cy",y);s.setAttribute("r",HEX_SIZE*0.55);
      s.setAttribute("opacity","0");s.classList.add("stone");gStones.appendChild(s);
      S.cells.set(k,{q,r,stone:0,hex:h,el:s});
    }
  }
  msg();
}

function onClick(e){
  if(S.gameOver)return;
  const k=e.target.dataset.k,c=S.cells.get(k);
  if(!c||c.stone)return;
  c.stone=S.turn;c.el.setAttribute("opacity","1");c.el.classList.add(S.turn===1?"p1":"p2");
  const res=judge(c.q,c.r,S.turn);
  if(res.win){drawLine(res.line);msg(`ğŸ¯ ${S.turn===1?"é»„":"ç™½"}ã®å‹ã¡ï¼`);S.gameOver=true;}
  else if(res.lose){msg(`ğŸ’¥ ${S.turn===1?"é»„":"ç™½"}ãŒ3é€£ã§è² ã‘`);S.gameOver=true;}
  else{S.turn=3-S.turn;msg();}
}

function cnt(q,r,dq,dr,p){let n=0;while(true){q+=dq;r+=dr;const c=S.cells.get(key(q,r));if(c&&c.stone===p)n++;else break;}return n;}
function judge(q,r,p){
  let win=false,lose=false,line=null;
  for(let i=0;i<3;i++){
    const [dq,dr]=DIRS[i],[dq2,dr2]=DIRS[i+3];
    const L1=cnt(q,r,dq,dr,p),L2=cnt(q,r,dq2,dr2,p),t=1+L1+L2;
    if(t>=4){win=true;const s=toXY(q-dq*L1,r-dr*L1),e=toXY(q+dq2*L2,r+dr2*L2);line=[s,e];}
    else if(t===3)lose=true;
  }
  return {win,lose:!win&&lose,line};
}
function drawLine(line){
  const L=document.createElementNS("http://www.w3.org/2000/svg","line");
  L.setAttribute("x1",line[0].x);L.setAttribute("y1",line[0].y);
  L.setAttribute("x2",line[1].x);L.setAttribute("y2",line[1].y);
  L.classList.add("win-line");gFx.appendChild(L);
}
init();
</script>
</body>
</html>
